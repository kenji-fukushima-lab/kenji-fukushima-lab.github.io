!function(){"use strict";const e=e=>(e??"").toString().trim().toLowerCase();document.addEventListener("DOMContentLoaded",()=>{const t=20,a=document.querySelector(".blog-content"),o=a?.querySelector(".post-list"),n=document.getElementById("blogsearch"),r=document.getElementById("blog-sort"),l=document.getElementById("blog-reset-filters"),s=document.getElementById("blog-facet-year"),i=document.getElementById("blog-facet-author"),d=document.getElementById("blog-active-count"),c=document.getElementById("blog-chart-year");if(!(a&&o&&n&&r&&l&&s&&i))return;const u=Array.from(o.querySelectorAll("li.post-card"));if(!u.length)return;const p=document.documentElement.lang.toLowerCase().startsWith("ja"),m=p?"ja":"en",g={allYears:p?"\u3059\u3079\u3066\u306e\u5e74":"All years",allAuthors:p?"\u3059\u3079\u3066\u306e\u6295\u7a3f\u8005":"All authors",noResults:p?"\u8a72\u5f53\u3059\u308b\u8a18\u4e8b\u304c\u3042\u308a\u307e\u305b\u3093\u3002":"No matching posts.",showing:p?"\u8868\u793a\u4e2d":"Showing",of:p?"\u5168":"of",posts:p?"\u4ef6":"posts",axisLabel:p?"\u8a18\u4e8b\u6570":"Number of posts",tooltipLabel:p?"\u8a18\u4e8b\u6570":"Posts",previous:p?"\u524d\u3078":"Previous",next:p?"\u6b21\u3078":"Next",pageLabel:p?"\u30da\u30fc\u30b8":"Page",paginationAria:p?"\u30d6\u30ed\u30b0\u30da\u30fc\u30b8\u30cd\u30fc\u30b7\u30e7\u30f3":"Blog pagination"},h=u.map((t,a)=>{const o=Number.parseInt(t.dataset.year??"0",10)||0,n=Date.parse(t.dataset.date??""),r=e(t.dataset.title),l=e(t.dataset.content),s=e(t.textContent),i=(t.dataset.author??"").toString().trim();return{index:a,card:t,year:o,dateMs:Number.isFinite(n)?n:0,author:i,authorKey:e(i),title:r,bodyText:l,searchText:`${r} ${s} ${l}`}}),b=h.map(e=>e.year).filter(e=>Number.isInteger(e)&&e>0),y=b.length?Math.min(...b):(new Date).getFullYear(),C=b.length?Math.max(...b):y,x=Array.from({length:C-y+1},(e,t)=>(y+t).toString()),v=document.createElement("nav");v.className="blog-pagination",v.setAttribute("aria-label",g.paginationAria),v.hidden=!0;const f=document.createElement("ul");f.className="pagination",v.appendChild(f),o.insertAdjacentElement("afterend",v);const E=document.createElement("p");E.className="blog-empty-state",E.textContent=g.noResults,E.hidden=!0,v.insertAdjacentElement("afterend",E);((e,t,a)=>{const o=e.value;e.innerHTML="";const n=document.createElement("option");n.value="",n.textContent=a,e.appendChild(n),t.forEach(t=>{const a=document.createElement("option");a.value=t,a.textContent=t,e.appendChild(a)}),o&&t.includes(o)&&(e.value=o)})(s,[...new Set(h.map(e=>e.year.toString()).filter(Boolean))].sort((e,t)=>Number.parseInt(t,10)-Number.parseInt(e,10)),g.allYears);const L=new Map;h.forEach(e=>{e.authorKey&&(L.has(e.authorKey)||L.set(e.authorKey,e.author))});const w=Array.from(L.entries()).sort((e,t)=>e[1].localeCompare(t[1],m)),M=i.value;i.innerHTML="";const $=document.createElement("option");$.value="",$.textContent=g.allAuthors,i.appendChild($),w.forEach(([e,t])=>{const a=document.createElement("option");a.value=e,a.textContent=t,i.appendChild(a)}),M&&w.some(([e])=>e===M)&&(i.value=M);let k=null,S=1;const A=()=>{const e=getComputedStyle(document.documentElement),t=(getComputedStyle(l).backgroundColor||"").trim(),a=e.getPropertyValue("--global-theme-color").trim()||"#2f7f75";return{themeColor:t&&"transparent"!==t&&"rgba(0, 0, 0, 0)"!==t?t:a,textColor:e.getPropertyValue("--global-text-color").trim()||"#334155",dividerColor:e.getPropertyValue("--global-divider-color").trim()||"#cbd5e1"}},N=(e,t)=>{d&&(d.textContent=p?`${g.showing} ${e}${g.posts} / ${g.of}${t}${g.posts}`:`${g.showing} ${e} ${g.of} ${t} ${g.posts}`)},I=(e,t,{disabled:a=!1,active:o=!1,ariaLabel:n=""}={})=>{const r=document.createElement("li");r.className="page-item",a&&r.classList.add("disabled"),o&&r.classList.add("active");const l=document.createElement("button");return l.type="button",l.className="page-link",l.textContent=e,l.dataset.page=t.toString(),a&&(l.disabled=!0,l.setAttribute("aria-disabled","true")),o&&l.setAttribute("aria-current","page"),n&&l.setAttribute("aria-label",n),r.appendChild(l),r},B=()=>{const e=document.createElement("li");e.className="page-item disabled";const t=document.createElement("span");return t.className="page-link",t.textContent="...",t.setAttribute("aria-hidden","true"),e.appendChild(t),e},T=e=>{const a=Math.max(1,Math.ceil(e/t));if(S>a&&(S=a),f.innerHTML="",0===e||1===a)return v.hidden=!0,a;v.hidden=!1,f.appendChild(I(g.previous,Math.max(1,S-1),{disabled:1===S,ariaLabel:g.previous}));const o=7;let n=Math.max(1,S-Math.floor(o/2)),r=Math.min(a,n+o-1);n=Math.max(1,r-o+1),n>1&&(f.appendChild(I("1",1,{active:1===S,ariaLabel:`${g.pageLabel} 1`})),n>2&&f.appendChild(B()));for(let e=n;e<=r;e+=1)f.appendChild(I(e.toString(),e,{active:e===S,ariaLabel:`${g.pageLabel} ${e}`}));return r<a&&(r<a-1&&f.appendChild(B()),f.appendChild(I(a.toString(),a,{active:S===a,ariaLabel:`${g.pageLabel} ${a}`}))),f.appendChild(I(g.next,Math.min(a,S+1),{disabled:S===a,ariaLabel:g.next})),a},q=e=>{if(!c||"function"!=typeof window.Chart)return;const t=new Map(x.map(e=>[e,0]));e.forEach(e=>{const a=e.year.toString();t.has(a)&&t.set(a,t.get(a)+1)});const a=x,o=a.map(e=>t.get(e)??0),n=A(),r=[{label:g.tooltipLabel,data:o,backgroundColor:n.themeColor,borderColor:n.themeColor,borderWidth:0}];if(k)return k.data.labels=a,k.data.datasets=r,k.options?.scales?.x?.ticks&&(k.options.scales.x.ticks.color=n.textColor),k.options?.scales?.x?.grid&&(k.options.scales.x.grid.color=n.dividerColor),k.options?.scales?.x&&(k.options.scales.x.stacked=!1),k.options?.scales?.y?.ticks&&(k.options.scales.y.ticks.color=n.textColor),k.options?.scales?.y?.grid&&(k.options.scales.y.grid.color=n.dividerColor),k.options?.scales?.y&&(k.options.scales.y.stacked=!1),k.options?.scales?.y?.ticks&&(k.options.scales.y.ticks.stepSize=1),k.options?.scales?.y?.title&&(k.options.scales.y.title.color=n.textColor),k.options?.plugins?.legend?.labels&&(k.options.plugins.legend.labels.color=n.textColor),void k.update();k=new window.Chart(c,{type:"bar",data:{labels:a,datasets:r},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1,labels:{color:n.textColor}},tooltip:{callbacks:{label:e=>{const t=Number(e.raw)||0;return`${g.tooltipLabel}: ${t}`}}}},scales:{x:{stacked:!1,ticks:{color:n.textColor,autoSkip:!0,maxRotation:0,minRotation:0},grid:{color:n.dividerColor}},y:{stacked:!1,beginAtZero:!0,ticks:{color:n.textColor,precision:0,stepSize:1},title:{display:!0,text:g.axisLabel,color:n.textColor},grid:{color:n.dividerColor}}}}})},P=()=>({query:e(n.value),year:e(s.value),author:e(i.value),sort:e(r.value)||"newest"}),K=(e,t)=>(!t.year||e.year.toString()===t.year)&&((!t.author||e.authorKey===t.author)&&!(t.query&&!e.searchText.includes(t.query)&&!e.title.includes(t.query))),R=(e,t)=>{const a=[...e];return"oldest"===t?a.sort((e,t)=>e.dateMs-t.dateMs||e.index-t.index):"title"===t?a.sort((e,t)=>e.title.localeCompare(t.title,m)||t.dateMs-e.dateMs):a.sort((e,t)=>t.dateMs-e.dateMs||e.index-t.index),a};let j=null,F=0;const D=(e=!1)=>{e&&(S=1);const a=P(),n=h.filter(e=>K(e,a)),r=R(n,a.sort),l=T(r.length);S>l&&(S=l);const s=(S-1)*t,i=r.slice(s,s+t),d=new Set(i.map(e=>e.index));h.forEach(e=>{const t=d.has(e.index);e.card.hidden=!t,e.card.style.display=t?"":"none"}),i.forEach(e=>o.appendChild(e.card)),E.hidden=r.length>0,N(r.length,h.length);const c=()=>{"function"!=typeof window.Chart?F>25||(F+=1,window.setTimeout(c,120)):q(r)};F=0,c()};n.addEventListener("input",()=>{j&&window.clearTimeout(j),j=window.setTimeout(()=>D(!0),120)}),r.addEventListener("change",()=>D(!0)),s.addEventListener("change",()=>D(!0)),i.addEventListener("change",()=>D(!0)),f.addEventListener("click",e=>{const t=e.target.closest("button[data-page]");if(!t||t.disabled)return;const a=Number.parseInt(t.dataset.page??"0",10);!Number.isFinite(a)||a<1||a===S||(S=a,D())}),l.addEventListener("click",()=>{n.value="",r.value="newest",s.value="",i.value="",D(!0)});new MutationObserver(()=>{D()}).observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),D(!0)})}();